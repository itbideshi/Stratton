<!--    @Author:        Umang Singhal
        @Date:          17/07/2018
        @Purpose:       Capture Personal details
-->
<aura:component controller="Stratt_DealLightningService"
                implements="force:appHostable,flexipage:availableForAllPageTypes,forceCommunity:availableForAllPageTypes" 
                extends="c:Stratt_LightningUtility">
    
    <!-- Handlers -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <!-- Handlers -->
    
    <!-- Attributes -->
    <aura:attribute name="applicationId" access="global" type="String" />
    <aura:attribute name="pagePicklistValues" type="Object" default="{}" />
    <aura:attribute name="showPage" access="global" type="Boolean" default="false" />
    <aura:attribute name="password" access="global" type="String" />
    <aura:attribute name="ApplicationObject" access="global" type="Object"/>
    <aura:attribute name="emailErrorMsg" access="global" type="String" default="This is an Error!"/>
    <aura:attribute name="ContactObject" access="global" type="Object" />
    <aura:attribute name="CoApplicantObject" access="global" type="Object"/>
    <aura:attribute name="AccountObject" access="global" type="Object" />
    <aura:attribute name="ParticipantList" access="global" type="Object"/>
    <aura:attribute name="factoryOptionList" access="global" type="Object" />
    <aura:attribute name="isDuplicate" access="global" type="Boolean" />
    <aura:attribute name="personalDetailWrp" type="Object" default="{}" />
    <aura:attribute name="StrAssetDetailPageValues" type="Object" default="{}" />
    <aura:attribute name="options" type="List" default="[
                                                        {'label': 'Yes', 'value': true},
                                                        {'label': 'No', 'value': false}
                                                        ]"/>
    <aura:attribute name="dropdownValueHandler" type="Object"/>
    <!-- Attributes -->
    
    <!-- Events -->
    <aura:registerEvent name="currentToMaster" type="c:Stratt_WizardNextScreen"/>
    <!-- Events -->
    
    <!-- Service Component -->
    <c:ServiceComponent aura:id="service" />
    <!-- Service Component -->
    <aura:if isTrue="{!v.showPage}">
    <div class="headerSpace"></div>
    <div class="container">
        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters">
            <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                <h1 class="heading3  slds-m-top_x-small slds-m-bottom_x-small">Tell us about yourself
                </h1>
                <div class="subheadingSmall slds-m-bottom_x-large ">We'll use this information to verify your identity.</div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-12">
            </div>
        </div>
        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters">
            <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                <div class="lhs_wrapper">
                    <form action="">
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_6-of-6 slds-large-size_12-of-12">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_3-of-6 slds-large-size_6-of-12">
                                        <div class="formElem">
                                            <div class="outlineNone">
                                                <label class="field_label">First name</label>
                                                <div class="input_fields ">
                                                    <lightning:input aura:id="firstNameId" 
                                                                     label=" " 
                                                                     required="true"
                                                                     maxlength="32"
                                                                     messageWhenTooLong="messageWhenTooLong"
                                                                     type="text" 
                                                                     value="{!v.ContactObject.FirstName}"                                                                   
                                                                     />
                                                    <em class="errMsg"></em>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_3-of-6 slds-large-size_6-of-12">
                                        <div class="formElem">
                                            <div class="outlineNone">
                                                <label class="field_label">Last name</label>
                                                <div class="input_fields ">
                                                    <lightning:input aura:id="lastNameId"
                                                                     maxlength="32"
                                                                     label=" " 
                                                                     required="true" type="text" value="{!v.ContactObject.LastName}"/>
                                                    <em class="errMsg">Dead</em>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1">
                                <div class="formElem">
                                    <label class="field_label">Email address</label>
                                    <div aura:id="emailErrorId" class="input_fields ">
                                        <lightning:input label=" " aura:id="emailId" maxlength="100"
                                                         required="true" type="email" 
                                                         readonly="{!$SObjectType.CurrentUser.Id}"
                                                         messageWhenTypeMismatch="Please enter a valid email address"
                                                         value="{!v.ContactObject.Email}"/>
                                        <em class="errMsg">{!v.emailErrorMsg}</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                <div class="formElem">
                                    <label class="field_label">Your mobile number</label>
                                    <div class="input_fields">
                                        <lightning:input type="text" 
                                                         maxlength="10"
                                                         label=" "
                                                         messageWhenPatternMismatch="Please enter a valid Australian mobile number" 
                                                         messageWhenValueMissing="Please enter a valid Australian mobile number."
                                                         pattern="^[0-9]{10}$" 
                                                         aura:id="mobileId"
                                                         required="true"
                                                         onblur="{!c.validateMobile}"
                                                         value="{!v.ContactObject.MobilePhone}"/>
                                        <em class="errMsg">This is an Error!</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_6-of-6 slds-large-size_11-of-12">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                        <div class="formElem mrgnB0">
                                            <div class="outline">
                                                <label class="field_label">Date of birth</label>
                                                <div aura:id="dobErrId" class="input_fields ">
                                                    <lightning:input aura:id="dobId" onblur="{!c.checkDOB}" label=" " type="date" value="{!v.ContactObject.Birthdate}"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                        <div class="formElem mrgnB0">
                                            <c:GenericDropdown itemList="{!v.personalDetailWrp.lstGender}" 
                                                               label="Gender" 
                                                               aura:id = "genderId"
                                                               mapValueToLabel = "{!v.pagePicklistValues.Gender__c}"
                                                               default="{!v.ContactObject.Gender__c ? v.ContactObject.Gender__c : 'Please select'}"                                                               
                                                               isAutoSuggest = "false"
                                                               ErrorMessage="Please select an option"
                                                               ValueChangeHandlerObject="{!v.dropdownValueHandler}"
                                                               ValueChangeHandlerName="genderValueChange"
                                                               />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sectionSep sectionSep"></div>
                        
                        <aura:if isTrue="{!!v.ContactObject.hasAusDL__c}" >
                            <div class="heading4">
                                <h3>What are your driver's license details?</h3>
                            </div>
                            <div class="slds-grid slds-wrap slds-gutters slds-m-top_medium">
                                <div class="slds-col slds-size_6-of-6 slds-large-size_11-of-12">
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-12">
                                            <div aura:id="licenseErrId" class="formElem ">
                                                <div class="outline">
                                                    <label class="field_label">License number</label>
                                                    <div class="input_fields ">
                                                        <lightning:input aura:id="licenseId" label=" "
                                                                         maxlength="9"
                                                                         minlength="4"
                                                                         pattern="^[0-9a-zA-Z]+$" 
                                                                         messageWhenPatternMismatch="Please enter a valid Australian licence number" 
                                                                         messageWhenTooShort="Your entry must be at least 4 characters."
                                                                         required="{!!v.ContactObject.hasAusDL__c}"
                                                                         type="text" value="{!v.ContactObject.DL_Number__c}"/>
                                                        <em class="errMsg">This is an Error!</em>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_3-of-6 slds-large-size_3-of-12">
                                            <div class="formElem">
                                                <c:GenericDropdown itemList="{!v.personalDetailWrp.lstState}" 
                                                                   label="State" 
                                                                   aura:id = "stateId"
                                                                   mapValueToLabel = "{!v.pagePicklistValues.DL_State__c}"
                                                                   default="{!v.ContactObject.DL_State__c ? v.ContactObject.DL_State__c : 'Please select'}"
                                                                   isAutoSuggest = "false"
                                                                   ErrorMessage="Please select an option"
                                                                   ValueChangeHandlerObject="{!v.dropdownValueHandler}"
                                                                   ValueChangeHandlerName="stateValueChange"/>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_3-of-6 slds-large-size_5-of-12">
                                            <div class="formElem">
                                                <c:GenericDropdown itemList="{!v.personalDetailWrp.lstLicensetype}" 
                                                                   label="Type" 
                                                                   aura:id = "typeId"
                                                                   mapValueToLabel = "{!v.pagePicklistValues.DL_Type__c}"
                                                                   ErrorMessage="Please select an option"
                                                                   default="{!v.ContactObject.DL_Type__c ? v.ContactObject.DL_Type__c : 'Please select'}"
                                                                   isAutoSuggest = "false"
                                                                   ValueChangeHandlerObject="{!v.dropdownValueHandler}"
                                                                   ValueChangeHandlerName="typeValueChange"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </aura:if>
                        
                        <div class="slds-grid slds-wrap slds-gutters slds-m-top_large slds-m-bottom_large">
                            <div class="slds-col slds-size_1-of-1">
                                <label class="cstm_input">
                                    <lightning:input label=" " type="checkbox" checked="{!v.ContactObject.hasAusDL__c}"/>
                                    <em></em> I don't have a current Australian driver's licence
                                </label>
                            </div>
                        </div>
                        <div class="sectionSep sectionSep"></div>
                        <div class="heading4">
                            <h3 class="heading4">What is your family situation?</h3></div>
                        <div class="slds-grid slds-wrap slds-gutters slds-m-top_large">
                            <div class="slds-col slds-size_6-of-6 slds-large-size_11-of-12">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-1 slds-large-size_8-of-12">
                                        <div class="formElem ">
                                            <div class="outline">
                                                <c:GenericDropdown itemList="{!v.personalDetailWrp.lstMaritalStatus}" 
                                                                   label="What's your relationship status?" 
                                                                   aura:id = "maritalId"
                                                                   mapValueToLabel = "{!v.pagePicklistValues.Marital_Status__c}"
                                                                   ErrorMessage="Please select an option"
                                                                   default="{!v.ContactObject.Marital_Status__c ? v.ContactObject.Marital_Status__c : 'Please select'}"
                                                                   ValueChangeHandlerObject="{!v.dropdownValueHandler}"
                                                                   ValueChangeHandlerName="maritalValueChange"
                                                                   isAutoSuggest = "false"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_5-of-6 slds-large-size_4-of-12">
                                        <div class="formElem">
                                            <c:GenericDropdown itemList="{!v.personalDetailWrp.lstDependants}" 
                                                               label="Dependents" 
                                                               aura:id = "dependentId"
                                                               mapValueToLabel = "{!v.pagePicklistValues.NoOfDependents__c}"
                                                               default="{!v.ContactObject.NoOfDependents__c}"
                                                               ValueChangeHandlerObject="{!v.dropdownValueHandler}"
                                                               ValueChangeHandlerName="dependentsValueChange"
                                                               isAutoSuggest = "false"/>                                            
                                            <label tabindex="-1" class="tooltip_info">
                                                <i class="material-icons">
                                                    info_outline
                                                </i>
                                                <span class="tooltip_msg">
                                                    <p class="slds-text-align_right">
                                                        <a href="javascript:void(0)" class="material-icons close">
                                                            close
                                                        </a>
                                                    </p>
                                                    Dependents include your children or people that you support financially.
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="sectionSep sectionSep"></div>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="formElem slds-m-top_x-large">
                                <div class="heading4  slds-m-bottom_medium">
                                    <h3 class="heading4 slds-m-top_medium slds-col slds-size_5-of-6 slds-large-size_8-of-12">Do you want to add a second applicant to the loan?</h3>
                                </div>
                                <label tabindex="-1" class="tooltip_info tooltip_info_heading1">
                                    <i class="material-icons">
                                        info_outline
                                    </i>
                                    <span class="tooltip_msg">
                                        <p class="slds-text-align_right">
                                            <a href="javascript:void(0)" class="material-icons close">
                                                close
                                            </a>
                                        </p>
                                        A second applicant will be jointly responsible for guaranteeing loan repayments.
                                    </span>
                                </label>
                                <div class="slds-col">
                                    <p class="slds-m-bottom_large">If yes, you will be contacted by a consultant to assist you in completing your application.</p>
                                    <lightning:radioGroup class="radioCont"
                                                          aura:id="mygroup1"
                                                          name="secondApplicantRadioGrp"
                                                          label="Radio Button Group"
                                                          options="{! v.options }"
                                                          value="{!v.ApplicationObject.hasSecondApplicant__c}"/>
                                </div>
                            </div>
                        </div>
                        <aura:if isTrue="{!v.ApplicationObject.hasSecondApplicant__c}">
                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12">
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                            <div class="formElem">
                                                <div class="outlineNone">
                                                    <label class="field_label">First name</label>
                                                    <div class="input_fields ">
                                                        <lightning:input label=" " maxlength="32" aura:id="secAppFirstNameId" type="text" required="true" value="{!v.CoApplicantObject.FirstName}"/>
                                                        <em class="errMsg"></em>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                            <div class="formElem">
                                                <div class="outlineNone">
                                                    <label class="field_label">Last name</label>
                                                    <div class="input_fields ">
                                                        <lightning:input label=" " aura:id="secAppLastNameId"
                                                                         maxlength="32" type="text" required="true" value="{!v.CoApplicantObject.LastName}"/>
                                                        <em class="errMsg"></em>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>                            
                        </aura:if>
                        <aura:if isTrue="{!((!v.ApplicationObject.Id &amp;&amp; !v.ContactObject.HasOptedOutOfEmail) || v.ContactObject.HasOptedOutOfEmail) ? true : false}" >
                        <div class="slds-grid slds-wrap slds-gutters slds-m-top_large slds-m-bottom_large">
                            <div class="slds-col slds-size_1-of-1">
                                <label class="cstm_input">
                                    <lightning:input aura:id="emailOptId" label=" " type="checkbox" onchange="{!c.setEmailOpt}" checked="{!!v.ContactObject.HasOptedOutOfEmail}"/>
                                    <em></em>I agree to receive emails from Stratton Finance
                                </label>
                            </div>
                        </div>
                        </aura:if>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-large-size_6-of-6 slds-m-top_large submitBtn">
                                <div class="formElem slds-clearfix stepsAction">
                                    <lightning:button onclick="{!c.processBack}" class="slds-button slds-button_brand btnBack slds-float_left" label="Back" />
                                    <lightning:button class="slds-button slds-button_brand btnBack slds-float_right" label="Save and continue" onclick="{!c.saveNext}"/>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-12 slds-show_large">
                <div class="messageWrapper">
                    <h2 class="msgHeading slds-m-bottom_medium">Helpful tip</h2>
                    <p>
                        Make sure your details match your driver's license and passport.
                    </p>
                </div>
            </div>
        </div>
    </div>
    </aura:if>
    <!-- Modal -->
    <div aura:id="passwordDiv" class="slds-hide">
        <section role="dialog" tabindex="-1"
                 aria-labelledby="modal-heading-01" aria-modal="true"
                 aria-describedby="modal-content-id-1"
                 class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__content">
                    <a onclick="{!c.onClose}" class="modalCrossIcon slds-float_right"  >
                        <i class="material-icons"  >
                            close
                        </i>
                    </a>
                    
                    <div class="passwordLightBox">
                        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters slds-m-bottom_xx-large">
                            <div class="slds-col slds-size_5-of-6 slds-large-size_10-of-12">
                                <h2 class="">Create your account to save your progress</h2>
                                <p >We'll send you an email to verify your address. Verification will be required prior to full application submission.</p>
                            </div>
                        </div>
                        
                        
                        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters slds-m-bottom_xx-small">
                            <div class="slds-col slds-size_5-of-6 slds-large-size_10-of-12">
                                <div class="formElem">
                                    <label class="field_label">Your Password</label>
                                    <div aura:id="passErrId" class="input_fields ">
                                        <lightning:input aura:id="passwordId" label=" " type="password" value="{!v.password}"/>                 
                                        <em class="errMsg">Your password does not match the below criteria.</em>
                                    	<div class="slds-m-top_small">Your password must contain at least eight characters, including one uppercase letter, one lowercase letter, one number and a special character.</div>
                                    </div>
                                </div>
                            </div>
                        </div>	
                        
                        
                        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters algnRd">
                            <div class="slds-col slds-size_5-of-6 slds-large-size_10-of-12 ">	
                                <lightning:button onclick="{!c.saveRecord}" 
                                                  class="slds-button slds-size_1-of-1 slds-large-size_1-of-12 slds-button_brand btnBack slds-m-bottom_x-large " 
                                                  label="Done" />
                            </div>
                        </div>	 
                    </div>
                    
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </div>
    <!-- Modal -->
    
    <!-- Duplicate Email Modal -->
    <div aura:id="duplicateEmailDiv" class="slds-hide">
        <section role="dialog" tabindex="-1"
                 aria-labelledby="modal-heading-01" aria-modal="true"
                 aria-describedby="modal-content-id-1"
                 class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__content">
                    <a onclick="{!c.onCloseDuplicate}" class="modalCrossIcon slds-float_right"  >
                        <i class="material-icons"  >
                            close
                        </i>
                    </a>
                    
                    <div class="passwordLightBox">
                        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters slds-m-bottom_xx-large">
                            <div class="slds-col slds-size_5-of-6 slds-large-size_10-of-12">
                                <h2 class="">Welcome back {!v.ContactObject.FirstName}!</h2>
                                <p class="subheading">Please login to continue your application</p>
                            </div>
                        </div>                        
                        
                        <div class="slds-grid slds-wrap slds-grid_align-center slds-gutters">
                            <div class="slds-col slds-size_5-of-6 slds-large-size_10-of-12 ">	
                                <lightning:button onclick="{!c.redirectToLoginPage}" 
                                                  class="slds-button slds-size_1-of-1 slds-large-size_1-of-12 slds-button_brand btnlogin slds-m-bottom_x-large " 
                                                  label="Login to your account" />
                            </div>
                        </div>	 
                    </div>
                    
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </div>
    <!-- Duplicate Email Modal -->
</aura:component>